<!DOCTYPE html><html lang="en-us"><head><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta name="description" content="Setting up Jekyll development environment using Vagrant and PuPHPet. Jekyll in virtual machine. Jekyll automation. Jekyll Vagrant."><meta name="author" content="Pavel Dmytrenko"><meta name="keywords" content="Python, Programming, Math, Algorithms"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><title>Blog | Jekyll development environment via Vagrant and PuPHPet &middot; Stochastic Stuff by Pavel Dmytrenko</title><link rel="stylesheet" href="/public/css/poole.css"><link rel="stylesheet" href="/public/css/lanyon.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400"><link href="/atom.xml" rel="alternate" title="Atom" type="application/atom+xml"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-68140687-1', 'auto');
  ga('send', 'pageview');</script></head><body><input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox"><div class="sidebar" id="sidebar"><div class="sidebar-item"><p>A place for Python, Math and maybe Science Fiction.</p></div><nav class="sidebar-nav"><a class="sidebar-nav-item" href="/"><svg class="icon-portal"></svg> Home</a> <a class="sidebar-nav-item" href="/about/"><svg class="icon-about"></svg> About</a> <a class="sidebar-nav-item" href="/archive/"><svg class="icon-archive"></svg> Archive</a> <a class="sidebar-nav-item" href="/tags/"><svg class="icon-tags"></svg> Tags</a></nav><div class="sidebar-item"><p>&copy; 2016. All rights reserved.</p></div></div><div class="wrap"><div class="masthead"><div class="container"><h3 class="masthead-title"><a href="/" rel="bookmark" title="Home" class="masthead-link">Stochastic Stuff</a> by <a href="/about/" rel="bookmark" title="About" class="masthead-link">Pavel Dmytrenko</a> <small></small> <a class="soc-icons" rel="bookmark" title="Atom feed" href="/atom.xml"><svg class="icon-rss"></svg></a> <a class="soc-icons" rel="external" title="@pavdmyt Twitter account" href="https://twitter.com/pavdmyt"><svg class="icon-bird"></svg></a> <a class="soc-icons" rel="external" title="My GitHub repos" href="https://github.com/pavdmyt"><svg class="icon-git"></svg></a></h3></div></div><div class="container content"><ul class="tags"><li><a href="/tags#jekyll" class="tag">jekyll</a></li><li><a href="/tags#vagrant" class="tag">vagrant</a></li><li><a href="/tags#puphpet" class="tag">puphpet</a></li><li><a href="/tags#blogging" class="tag">blogging</a></li></ul><div class="post"><h1 class="post-title">Jekyll development environment via Vagrant and PuPHPet</h1><span class="post-date"><svg class="icon-calendar"></svg> 28 January 2016</span><p>It happened that I developed at both Linux and Windows machines. And as you may know, installing, building and maintaining development environments in such case is always a burden. Common solution is to keep your environment inside a virtual machine (VM). This prevents from polluting the hostbox with unnecessary software. Most importantly, we can set up our VM to mimic the production environment as closely as possible.</p><p>The traditional scenario of maintaining a development VM introduces a set of routines which we prefer to avoid. First, a lot of initial setup. Second, we can easily damage our setup by making some minor changes. Third, it is difficult to share pre-configured VMs because they occupy a couple of gigabytes. This is a time consuming and error-prone process…</p><p>We need a way to manage our development VMs and here comes <a href="https://www.vagrantup.com/">Vagrant</a>.</p><blockquote><p>Vagrant lowers development environment setup time, increases development/production parity, and makes the “works on my machine” excuse a relic of the past.</p></blockquote><p>Vagrant key advantages are in that it helps to automate the initial setup of a virtual machine, is available everywhere (Linux, Mac, Windows), and allows us to share VM settings by a single <a href="https://www.vagrantup.com/docs/vagrantfile/"><code>Vagrantfile</code></a>.</p><p>Recently I managed to set up a development environment for this blog using Vagrant complemented with <a href="https://puphpet.com/">PuPHTet</a>. PuPHPet is a web GUI for setting up VMs for our needs. It uses <a href="https://puppetlabs.com/">Puppet</a> as the provisioning backend.</p><p>Let’s take a look at some simple configuration steps to make our lives easier and development environments more consistent.</p><h2 id="what-we-need">What we need</h2><p>To build static sites with Jekyll we need at least the following:</p><ul><li><a href="https://www.ruby-lang.org/en/">Ruby</a></li><li><a href="https://rubygems.org/pages/download">RubyGems</a></li></ul><p>If you are running Jekyll 2 and/or hosting at <a href="https://pages.github.com/">GitHub Pages</a> (<em>as of January 2016 GitHub Pages running Jekyll 2.4.0</em>), then you’ll also need:</p><ul><li><a href="https://nodejs.org/en/">NodeJS</a></li><li><a href="https://www.python.org/downloads/">Python 2.7</a></li></ul><p>Our <em>virtual machine</em> should also be configured to share a directory where all development happens with a <em>host machine</em> to modify files from our host and have them automatically synced to the development VM. Another requirement is an ability to access Jekyll development server running inside a VM from the browser at host machine. This could be done by setting basic <em>port forwarding</em>.</p><h2 id="vagrant">Vagrant</h2><p>After <a href="https://www.vagrantup.com/docs/installation/">installing Vagrant</a> we can initialize our project:</p><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>mkdir our_project
<span class="nv">$ </span><span class="nb">cd </span>our_project
<span class="nv">$ </span>vagrant init</code></pre></div><p>This will create a <code>Vagrantfile</code> in the current directory. It contains our virtual machine’s configuration and provisioning settings. Let’s modify it for our purposes.</p><h3 id="choosing-a-base-image-box">Choosing a base image (box)</h3><p>Choose a desired box from the <a href="https://atlas.hashicorp.com/boxes/search">Atlas</a>. As an example I want to create my environment on top of <em>Debian 8 “jessie”</em> which corresponds to <code>debian/jessie64</code> in the Atlas. We have to add this box to Vagrant:</p><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>vagrant box add debian/jessie64</code></pre></div><p>and set it in <code>Vagrantfile</code>:</p><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&quot;debian/jessie64&quot;</span></code></pre></div><h3 id="shared-folders">Shared folders</h3><p>By default Vagrant shares directory with <code>Vagrantfile</code> to <code>/vagrant</code>. However we can manually set up some additional synced folders:</p><div class="highlight"><pre><code class="language-bash" data-lang="bash">config.vm.synced_folder <span class="s2">&quot;src/&quot;</span>, <span class="s2">&quot;/srv/website&quot;</span></code></pre></div><p>The first parameter is a path to a directory on the host machine. If the path is relative, it is relative to the project root. The second parameter must be an absolute path of where to share the folder within the guest machine. This folder will be created (recursively, if it must) if it does not exist.</p><h3 id="port-forwarding">Port forwarding</h3><p>In order to access our Jekyll blog served by development server inside a VM using host machine web browser, we have to specify ports on the virtual machine to share via a port on the host machine:</p><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="ss">:forwarded_port</span><span class="p">,</span> <span class="ss">guest</span><span class="p">:</span> <span class="mi">4000</span><span class="p">,</span> <span class="ss">host</span><span class="p">:</span> <span class="mi">8080</span></code></pre></div><p>Here we specify <code>guest: 4000</code> because Jekyll development server by default listens port 4000.</p><h3 id="resource-allocation">Resource allocation</h3><p>It is possible to specify how many RAM and CPU resources we allocate to our VM:</p><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provider</span> <span class="s2">&quot;virtualbox&quot;</span> <span class="k">do</span> <span class="o">|</span><span class="n">v</span><span class="o">|</span>
  <span class="n">v</span><span class="o">.</span><span class="n">memory</span> <span class="o">=</span> <span class="mi">512</span>
  <span class="n">v</span><span class="o">.</span><span class="n">cpus</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">end</span></code></pre></div><h3 id="basic-configuration">Basic configuration</h3><p>Finally, let’s place our settings into <code>Vagrantfile</code>:</p><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Vagrant</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&quot;debian/jessie64&quot;</span>
  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">synced_folder</span> <span class="s2">&quot;src/&quot;</span><span class="p">,</span> <span class="s2">&quot;/srv/website&quot;</span>
  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="ss">:forwarded_port</span><span class="p">,</span> <span class="ss">guest</span><span class="p">:</span> <span class="mi">4000</span><span class="p">,</span> <span class="ss">host</span><span class="p">:</span> <span class="mi">8080</span>

  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provider</span> <span class="s2">&quot;virtualbox&quot;</span> <span class="k">do</span> <span class="o">|</span><span class="n">v</span><span class="o">|</span>
    <span class="n">v</span><span class="o">.</span><span class="n">memory</span> <span class="o">=</span> <span class="mi">512</span>
    <span class="n">v</span><span class="o">.</span><span class="n">cpus</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div><h3 id="provisioning">Provisioning</h3><p>After basic configuration is done and we have a VM running vanilla Debian “jessie”, type <code>vagrant ssh</code> to ssh into development machine. Now we can manually install all needed packages. But then every person who used Vagrant would have to do the same thing. To avoid such inconveniences Vagrant supports <em>automated provisioning</em>. It is possible to write a shell script to configure the host. We also can use Ansible, Chef or Puppet.</p><p>Initially I’ve spent an hour to write a shell script with lots of <code>sudo apt-get install package_X</code>, <code>gem install ...</code>, <code>git clone ...</code>, etc.</p><p>Launched it…<br>and everything messed up!</p><p>After some debugging I realized that someone probably have already encountered such difficulties and that workaround should exist. And it does!</p><h2 id="puphtet-to-the-rescue">PuPHTet to the rescue!</h2><p>Basically it’s a <a href="https://puphpet.com/">web app</a> which provides GUI with everything you need to setup a virtual machine for web development. After configuration steps are done we’ll be able to download a zip archive with all prerequisites for our project. The only thing remains is to extract the archive, open terminal and <code>cd</code> to the extracted folder. Finally, <code>$ vagrant up</code> and go grab some tea or coffee while our development VM is being prepared.</p><p>Let’s take a look at basic configuration steps for the Jekyll project.</p><h3 id="local-vm-details">Local VM details</h3><p>Here we choose <strong>Deploy to Local Host</strong> as VM will live at our host machine. <strong>VirtualBox</strong> as virtualization provider (<em>PuPHPet now requires VirtualBox 5 as the minimum required version</em>). And specifying desired <strong>Distro</strong>, <em>Ubuntu Trusty x64</em> is a default selection.</p><p><img src="/public/images/vm_details.png" alt="vm details" class="center-image"></p><p>IP, allocated RAM and CPUs, <a href="https://www.vagrantup.com/docs/networking/forwarded_ports.html">Port Forwarding</a> settings:</p><p><img src="/public/images/ip_resources_port_fwd.png" alt="net resources" class="center-image"></p><p>By default Jekyll development server listens port 4000, however we can set any port via <code>--port</code> option:</p><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>jekyll serve --port 5050</code></pre></div><h3 id="system-packages">System Packages</h3><p>List here packages you need. Here is my selection:</p><p><img src="/public/images/sys_packs.png" alt="packages" class="center-image"></p><h3 id="web-servers-nginx-apache">Web Servers: Nginx, Apache</h3><p>Deselect. We don’t need them.</p><h3 id="languages">Languages</h3><p><strong>PHP</strong> - deselect.</p><p><strong>Ruby</strong> is needed to install Jekyll. PuPHPet proposes installation via <a href="https://rvm.io/">RVM</a> with latest available version of Ruby is 2.0.0 (<em>as of January 2016, Ruby 2.3.0 is available</em>).</p><p>Personally, I prefer <a href="https://github.com/rbenv/rbenv">rbenv</a> combined with <a href="http://bundler.io/">Bundler</a> which allows to install desired Jekyll version and all dependencies typing <code>bundle install</code> in a folder with <a href="http://bundler.io/v1.11/gemfile.html">Gemfile</a>. So, I’m skipping “<em>Ruby via RVM</em>” and installing <strong>rbenv</strong> with <strong>Bundler</strong> manually after VM provisioning.</p><p><strong>Python</strong> is required if we are running Jekyll 2 and/or hosting our site at GitHub Pages (<em>as of January 2016 GitHub Pages running Jekyll 2.4.0</em>). Python is also a dependency if we are using <a href="http://pygments.org/">Pygments</a> syntax highlighter in Jekyll 3 instead of default <a href="http://rouge.jneen.net/">Rouge</a>.</p><p><strong>Node.js</strong> is used as JavaScript runtime for Jekyll 2. Deselect for Jekyll 3 projects.</p><p><strong>HHVM</strong> - deselect.</p><h3 id="other-options">Other options</h3><p>All other options for <strong>Databases</strong>, <strong>Mail Tools</strong>, <strong>Work Queues</strong> and <strong>Search Servers</strong> can be unchecked if you are not building something peculiar with Jekyll and 100% sure that some of these is a must.</p><h3 id="create-archive">Create Archive</h3><p>Now we can download a zip archive with resulted <code>Vagrantfile</code> and Puppet provisioning scripts:</p><p><img src="/public/images/download_archive.png" alt="download page" class="center-image"></p><h3 id="add-your-dotfiles">Add your dotfiles</h3><p>Unpack the archive. We can put desired <code>.bashrc</code>, <code>.vimrc</code>, <code>.gitconfig</code>, etc into the <code>/puphpet/files/dot/</code> folder and they will be carefully placed into a home folder of our development VM.</p><h3 id="configyaml">config.yaml</h3><p>All provisioning settings are available in <code>puphpet/config.yaml</code> file. Here, we can modify virtual machine resource allocation, port forwarding, shared folders, installed packages, etc.</p><p>When all is ready, go into extracted folder and type <code>vagrant up</code> to start provisioning.</p><h3 id="check-our-setup">Check our setup</h3><p>After VM provisioning is done, <code>vagrant ssh</code> into VM and check that Jekyll is installed (<em>if Ruby installation via RVM is skipped, Jekyll and all its Ruby dependencies should be installed manually before these checks</em>):</p><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>jekyll --version
jekyll 2.4.0  <span class="c"># depends on specified version</span>

<span class="c"># go to project dir (/var/www by default) and launch jekyll server:</span>
<span class="nv">$ </span><span class="nb">cd</span> /var/www
<span class="nv">$ </span>jekyll serve</code></pre></div><p>Also ensure that jekyll development server is available from the host machine by loading <code>http://127.0.0.1:4000</code> in a browser.</p><h2 id="wrapping-up">Wrapping Up</h2><p>That’s all we need! Now you can focus on your Jekyll project isolated inside pre-configured environment and forget about risks to damage something by installing or updating your software. If things went wrong it is always possible to recreate environment from scratch using our Vagrantfile and Puppet scripts.</p></div><div class="related"><h2>Related Posts</h2><ul class="related-posts"><li><h3><a href="/python-solutions-project-euler-01-10">Python solutions for the Project Euler (problems 1-10) <small>13 Jan 2016</small></a></h3></li><li><h3><a href="/how-to-implement-tags-at-jekyll-website">How to implement Tags at Jekyll website <small>14 Oct 2015</small></a></h3></li><li><h3><a href="/digging-around-factorial-function">Digging around factorial function <small>01 Oct 2015</small></a></h3></li></ul></div><div id="disqus_thread"></div><script type="text/javascript">/* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'pavdmyt';
    var disqus_identifier = "/jekyll-dev-env-via-vagrant-and-puphpet";  // Fixes issue with different disqus comments on page / and /index.html

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript><div class="footer"><p class="copyright">&copy; Copyright 2016 by Pavel Dmytrenko.</p></div></div></div><label for="sidebar-checkbox" class="sidebar-toggle"></label><script>(function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);</script></body></html>