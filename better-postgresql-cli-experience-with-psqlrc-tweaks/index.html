<!DOCTYPE html><html lang="en-us"><head><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta name="description" content="PostgreSQL psql customization. psqlrc tweaks, tricks, settings, options. How to customize PostgreSQL/psql. psqlrc dot file. Modify, customize psql terminal."><meta name="author" content="Pavel Dmytrenko"><meta name="keywords" content="Python, Programming, Math, Algorithms, Jekyll, Static sites, Blogging"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><title>Blog | A better PostgreSQL CLI experience with few psqlrc tweaks &middot; Stochastic Stuff by Pavel Dmytrenko</title><link rel="stylesheet" href="/public/css/poole.css"><link rel="stylesheet" href="/public/css/lanyon.css"><link rel="stylesheet" href="/public/css/ir-black.css"><script src="/public/js/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400"><link href="/atom.xml" rel="alternate" title="Atom" type="application/atom+xml"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-68140687-1', 'auto');
  ga('send', 'pageview');</script></head><body><input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox"><div class="sidebar" id="sidebar"><div class="sidebar-item"><p>A place for Python, Math and maybe Science Fiction.</p></div><nav class="sidebar-nav"><a class="sidebar-nav-item" href="/"><svg class="icon-portal"></svg> Home</a> <a class="sidebar-nav-item" href="/about/"><svg class="icon-about"></svg> About</a> <a class="sidebar-nav-item" href="/archive/"><svg class="icon-archive"></svg> Archive</a> <a class="sidebar-nav-item" href="/tags/"><svg class="icon-tags"></svg> Tags</a></nav><div class="sidebar-item"><p>&copy; 2016. All rights reserved.</p></div></div><div class="wrap"><div class="masthead"><div class="container"><h3 class="masthead-title"><a href="/" rel="bookmark" title="Home" class="masthead-link">Stochastic Stuff</a> by <a href="/about/" rel="bookmark" title="About" class="masthead-link">Pavel Dmytrenko</a> <small></small> <a class="soc-icons" rel="bookmark" title="Atom feed" href="/atom.xml"><svg class="icon-rss"></svg></a> <a class="soc-icons" rel="external" title="@pavdmyt Twitter account" href="https://twitter.com/pavdmyt"><svg class="icon-bird"></svg></a> <a class="soc-icons" rel="external" title="My GitHub repos" href="https://github.com/pavdmyt"><svg class="icon-git"></svg></a></h3></div></div><div class="container content"><ul class="tags"><li><a href="/tags#PostgreSQL" class="tag">PostgreSQL</a></li><li><a href="/tags#databases" class="tag">databases</a></li><li><a href="/tags#dotfiles" class="tag">dotfiles</a></li></ul><div class="post"><h1 class="post-title">A better PostgreSQL CLI experience with few psqlrc tweaks</h1><span class="post-date"><svg class="icon-calendar"></svg> 12 March 2016</span><p>From <strong>psql</strong> <em>man page</em>:</p><blockquote><div style="font-size:90%"><code>psql</code> attempts to read and execute commands from the system-wide startup file (<code>psqlrc</code>) and then the user's personal startup file (<code>~/.psqlrc</code>), after connecting to the database but before accepting normal commands. These files can be used to set up the client and/or the server to taste, typically with <code>\set</code> and <code>SET</code> commands.</div></blockquote><p>Like with any dotfiles we can utilize <strong>psqlrc</strong> to customize <strong>psql</strong> behavior, look and feel. First, let’s create <strong>psqlrc</strong>. We have three options:</p><h3 id="create-system-wide-psqlrc">Create system-wide <code>psqlrc</code></h3><p>It should be located inside PostgreSQL’s system configuration directory, which could be found using <strong>pg_config</strong> tool:</p><div class="highlight"><pre><code class="language-bash" data-lang="bash">$ pg_config --sysconfdir
/etc/postgresql-common</code></pre></div><p>Location may vary depending on your PostgreSQL installation. I’m running it at <em>Ubuntu 14.04</em> and configuration files are located at <code>/etc/postgresql-common</code>.</p><h3 id="users-personal-psqlrc">User’s personal <code>psqlrc</code></h3><p>Just create it in your home directory:</p><div class="highlight"><pre><code class="language-bash" data-lang="bash">$ touch ~/.psqlrc</code></pre></div><h3 id="version-specific-psqlrc">Version-specific <code>psqlrc</code></h3><p><em>Man pages</em> are cool:</p><blockquote><div style="font-size:90%">Both the system-wide startup file and the user's personal startup file can be made psql-version-specific by appending a dash and the PostgreSQL major or minor release number to the file name, for example ~/.psqlrc-9.2 or ~/.psqlrc-9.2.5. The most specific version-matching file will be read in preference to a non-version-specific file.</div></blockquote><p>Depending on specific needs and preferences, choose location for <strong>psqlrc</strong> that suits your needs most. Let’s move forward for the actual configuration.</p><h2 id="actual-configuration">Actual configuration</h2><p>Here is my <code>psqlrc</code> with comments for the settings:</p><div class="highlight"><pre><code class="language-sql" data-lang="sql">\set QUIET 1

-- Errors are ignored in interactive sessions,
-- and not when reading script files.
\set ON_ERROR_ROLLBACK interactive

-- To have all queries display query times.
\timing

-- Verbose error reports.
\set VERBOSITY verbose

-- Use table format (with headers across the top) by default,
-- but switch to expanded table format when there&#39;s a lot of data,
-- which makes it much easier to read.
\x auto

-- Use a separate history file per-database.
\set HISTFILE ~/.psql_history- :DBNAME

-- If a command is run more than once in a row,
-- only store it once in the history.
\set HISTCONTROL ignoredups

-- By default, NULL displays as an empty space. Is it actually an empty
-- string, or is it null? This makes that distinction visible.
\pset null &#39;(null)&#39;

\unset QUIET</code></pre></div><p>Let’s take a look at some of the options in more details.</p><h3 id="quiet-flag"><code>QUIET</code> flag</h3><p>At startup <strong>psql</strong> executes commands from <strong>psqlrc</strong>, which creates unnecessary output. In order to hide it, we set <code>QUIET</code> flag at the top of <strong>psqlrc</strong> and unset it at the bottom of the file.</p><h3 id="onerrorrollback"><code>ON_ERROR_ROLLBACK</code></h3><p>Allows statements in a <em>transaction</em> to error without affecting the entire transaction. Valid values are <code>on</code>, <code>interactive</code> or <code>off</code>.</p><p>From the <a href="http://www.postgresql.org/docs/current/static/app-psql.html">manual</a>:</p><blockquote><div style="font-size:90%"><p>When set to <code>on</code>, if a statement in a transaction block generates an error, the error is ignored and the transaction continues.</p><p>When set to <code>interactive</code>, such errors are only ignored in interactive sessions, and not when reading script files.</p><p>When unset or set to <code>off</code>, a statement in a transaction block that generates an error aborts the entire transaction.</p><p>The error rollback mode works by issuing an implicit SAVEPOINT for you, just before each command that is in a transaction block, and then rolling back to the savepoint if the command fails.</p></div></blockquote><p>I’m using the <code>interactive</code> mode because this gives a chance to fix things while in interactive session without starting over.</p><h3 id="timing"><code>\timing</code></h3><p>Conveniently shows how long each SQL statement takes, in milliseconds:</p><div class="highlight"><pre><code class="language-sql" data-lang="sql">test=&gt; SELECT * FROM weather
       WHERE prpc IS NOT NULL;
     city      | temp_lo | temp_hi | prpc |    date
---------------+---------+---------+------+------------
 San Francisco |      46 |      50 | 0.25 | 1994-11-27
 San Francisco |      41 |      55 |    0 | 1994-11-29
(2 rows)

Time: 0.652 ms</code></pre></div><h2 id="wrapping-up">Wrapping Up</h2><p>Given <strong>psqlrc</strong> contains some basic tweaks for improving <strong>psql</strong> experience. A lot more could be found at the <em>manpage</em> or in the <a href="http://www.postgresql.org/docs/current/static/app-psql.html">official PostgreSQL documentation</a>. Use it to adapt your settings for specific needs or workflows.</p><br><p style="font-size:90%">Previous post: <a href="/simplifying-extending-jekyll-cli-with-jtasks">Simplifying and extending Jekyll CLI capabilities using Jtasks</a></p></div><div id="disqus_thread"></div><script type="text/javascript">/* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'pavdmyt';
    var disqus_identifier = "/better-postgresql-cli-experience-with-psqlrc-tweaks";  // Fixes issue with different disqus comments on page / and /index.html

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript><div class="footer"><p class="copyright">&copy; Copyright 2016 by Pavel Dmytrenko.</p></div></div></div><label for="sidebar-checkbox" class="sidebar-toggle"></label><script>(function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);</script></body></html>