<!DOCTYPE html><html lang="en-us"><head><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta name="description" content="Fast factorial calculation in Python. Python factorial HOWTO tutorial."><meta name="author" content="Pavel Dmytrenko"><meta name="keywords" content="Python, Programming, Math, Algorithms"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><title>Blog | Digging around factorial function &middot; Stochastic Stuff by Pavel Dmytrenko</title><link rel="stylesheet" href="/public/css/poole.css"><link rel="stylesheet" href="/public/css/lanyon.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400"><link href="/atom.xml" rel="alternate" title="Atom" type="application/atom+xml"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-68140687-1', 'auto');
  ga('send', 'pageview');</script></head><body><input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox"><div class="sidebar" id="sidebar"><div class="sidebar-item"><p>A place for Python, Math and maybe Science Fiction.</p></div><nav class="sidebar-nav"><a class="sidebar-nav-item" href="/"><svg class="icon-portal"></svg> Home</a> <a class="sidebar-nav-item" href="/about/"><svg class="icon-about"></svg> About</a> <a class="sidebar-nav-item" href="/archive/"><svg class="icon-archive"></svg> Archive</a> <a class="sidebar-nav-item" href="/tags/"><svg class="icon-tags"></svg> Tags</a></nav><div class="sidebar-item"><p>&copy; 2016. All rights reserved.</p></div></div><div class="wrap"><div class="masthead"><div class="container"><h3 class="masthead-title"><a href="/" rel="bookmark" title="Home" class="masthead-link">Stochastic Stuff</a> by <a href="/about/" rel="bookmark" title="About" class="masthead-link">Pavel Dmytrenko</a> <small></small> <a class="soc-icons" rel="bookmark" title="Atom feed" href="/atom.xml"><svg class="icon-rss"></svg></a> <a class="soc-icons" rel="external" title="@pavdmyt Twitter account" href="https://twitter.com/pavdmyt"><svg class="icon-bird"></svg></a> <a class="soc-icons" rel="external" title="My GitHub repos" href="https://github.com/pavdmyt"><svg class="icon-git"></svg></a></h3></div></div><div class="container content"><ul class="tags"><li><a href="/tags#python" class="tag">python</a></li><li><a href="/tags#math" class="tag">math</a></li><li><a href="/tags#algorithms" class="tag">algorithms</a></li></ul><div class="post"><h1 class="post-title">Digging around factorial function</h1><span class="post-date"><svg class="icon-calendar"></svg> 01 October 2015</span><p><a href="https://gist.github.com/fmeyer/289467">Evolution of a Python programmer</a> is a brilliant example of Python code produced by people with different backgrounds to solve a mostly simple problem of finding a factorial of the given number. Unfortunately it lacks solution which might be hypothetically produced by mathematician. Let’s add some entropy to the Universe and implement a weird factorial calculation using exponential function and logarithms:</p><p><img src="/public/images/math_fla.jpg" alt="analytical expression" class="center-image"></p><p>The series in the exponent can be represented as a <em>list comprehension</em>:</p><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span></code></pre></div><p>For the final solution let’s find a <code>sum</code> of the series and put it inside <code>math.exp()</code>:</p><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">math</span> <span class="kn">as</span> <span class="nn">m</span>
<span class="k">def</span> <span class="nf">fact</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="nb">sum</span><span class="p">([</span><span class="n">m</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">)]))</span></code></pre></div><p>But unfortunately, such calculation provides distorted results. We are dealing here with floating-point numbers, this results in the <a href="https://docs.python.org/3/tutorial/floatingpoint.html">issues and limitations</a> which are caused by the fact that floating-point numbers are represented in computer hardware as base 2 (binary) fractions. Let’s <code>import math as m</code> and examine the output:</p><p><img src="/public/images/ipython_run.jpg" alt="ipython session"></p><p>As can be seen there is a lot of ugliness after the decimal point. It is not allowable for our hypothetical mathematician! Moreover, our weird implementation is much more slower than the common iterative factorial function:</p><p><img src="/public/images/ipython_timeit.jpg" alt="ipython timeit"></p><p>Let’s fix the situation and try to write the function that calculates factorial of the given number and which is faster then the common iterative implementation. Recursive implementation is not considered because recursion in Python requires the allocation of a new stack frame and thus (in general) slower.</p><h2 id="fast-factorial">Fast factorial</h2><p>I was inspired by the method to <em>half the amount of multiplying</em> from this <a href="https://sites.google.com/site/examath/research/factorials">article</a>.</p><blockquote><p>To half the multiplication with even numbers, you will end up with the number, divided by two, factors. The first factor will be the number you are taking the factorial of, then the next will be that number plus that number minus two. The next number will be the previous number plus the lasted added number minus two. You are done when the last number you added was two.</p></blockquote><p>Example from the article:</p><blockquote><p>8! = 8 * (8 + 6 = 14) * (14 + 4 = 18) * (18 + 2 = 20)<br>8! = 8 * 14 * 18 * 20</p></blockquote><p>Pay attention to the bold numbers:</p><p>8! = <strong>8</strong> * (8 + <strong>6</strong> = 14) * (14 + <strong>4</strong> = 18) * (18 + <strong>2</strong> = 20)</p><p>So, basically we have a list of the numbers <code>[8, 6, 4, 2]</code> which can be used to find <em>factors</em> of <code>8!</code>.</p><div class="highlight"><pre><code class="language-pycon" data-lang="pycon"><span class="go">8! = 8 * 14 * 18 * 20 =</span>

<span class="go">(8) *</span>
<span class="go">(8 + 6) *</span>
<span class="go">(8 + 6 + 4) *</span>
<span class="go">(8 + 6 + 4 + 2) =</span>
<span class="go">40320</span></code></pre></div><p>Now, it becomes clear how to implement described logic in Python. All we need is:</p><ol><li>Build a list of the <em>even</em> numbers including and below given number, e.g. for <code>10!</code> it should be <code>[10, 8, 6, 4, 2]</code>.</li><li>Each iteration finds next <em>factor</em> by adding the elements of the list: <code>10, 10 + 8, ..., 10 + 8 + 6 + 4 + 2</code>.</li><li>Each iteration multiplies found <em>factors</em>.</li></ol><p>Here is the code:</p><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">fast_fact</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">nums</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">nums</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="n">num</span>
        <span class="n">res</span> <span class="o">*=</span> <span class="n">i</span>
    <span class="k">return</span> <span class="n">res</span></code></pre></div><p>Wait. This method works for <em>even</em> numbers, how about <em>odd</em> ones? The most natural solution that comes to mind is finding a factorial of the <em>even</em> number before the <em>odd</em> and times it by the <em>odd</em> number <code>9! = 8! * 9</code>. Let’s add a hook to our function to handle <em>odd</em> numbers too:</p><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">fast_fact</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">x</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">nums</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">nums</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="n">num</span>
        <span class="n">res</span> <span class="o">*=</span> <span class="n">i</span>
    <span class="k">return</span> <span class="n">res</span></code></pre></div><p><a href="https://sites.google.com/site/examath/research/factorials">Article</a> also mentions another method to handle <em>odd</em> numbers but we will not implement it since this makes solution more complicated and clarity also suffers. Now, let’s <code>timeit</code> against iterative factorial from the first part of our investigation:</p><p><img src="/public/images/ipython_timeit2.jpg" alt="ipython timeit"></p><p>Now our hypothetical mathematician can be satisfied.</p><p><em>All code from the article is available here:</em> <a href="https://gist.github.com/pavdmyt/3b99e9b499289e072a48">some_factorials.py</a>.</p><br><p style="font-size:90%">Previous post: <a href="/python-zip-fu">Python zip( ) Fu</a></p><p style="font-size:90%">Next post: <a href="/how-to-implement-tags-at-jekyll-website">How to implement Tags at Jekyll website</a></p></div><div id="disqus_thread"></div><script type="text/javascript">/* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'pavdmyt';
    var disqus_identifier = "/digging-around-factorial-function";  // Fixes issue with different disqus comments on page / and /index.html

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript><div class="footer"><p class="copyright">&copy; Copyright 2016 by Pavel Dmytrenko.</p></div></div></div><label for="sidebar-checkbox" class="sidebar-toggle"></label><script>(function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);</script></body></html>